/* ==========================================================================
   Responsive Styles
   ========================================================================== */

/* 1. Story Content Area Container Queries */
@container storycontent (max-width: 93.75rem) {
	/* Story Layout Changes */
	.story-content-area {
		flex-direction: column;
	}

	/* Table of Contents (TOC) Adjustments */
	.session-toc {
		block-size: auto;
	}

	.toc {
		position: relative;
		inset-block-start: 0; /* Changed from inset-block-start: 0; */
		max-block-size: 15.625rem;
		padding: 0.75rem;
		overflow: auto;
	}

	/* Session Content Formatting */
	.session-content {
		align-items: center;
	}

	/* Content Width Limit */
	.session-header,
	.session-small-recap,
	.session-main-content,
	.session-factual-content,
	.session-factual-header {
		max-inline-size: calc(100% - 3rem);
	}
}

/* 2. Media Queries (Combined and Organized) */

/* Large Breakpoint (max-width: 1500px) - Primarily Timeline */
@media (max-width: 1500px) {
	/* Timeline Header */
	.timeline-header {
		width: calc(100% - 2rem);
		margin: 0 auto;
		padding-top: 0.5rem;
	}

	/* Timeline Container */
	.story-timeline-container {
		align-items: unset;
		height: 100%;
	}

	/* Main Timeline Styles */
	.timeline {
		width: 80%;
		margin: 0 auto;

		&::before {
			left: 0;
			transform: none;
		}
	}

	/* Timeline Items */
	.timeline-item {
		width: calc(100% - 2rem);
		margin-left: 2rem;
	}

	.timeline-item.left,
	.timeline-item.right {
		align-self: flex-start;
	}

	.timeline-main-item {
		margin-top: 1rem;

		&.left,
		&.right {
			border-left: 4px solid #d5ae5d;
			border-right-width: 1px;

			&::before {
				left: -3.5rem;
			}

			&::after {
				left: -2rem;
				right: auto;
			}
		}
	}

	.timeline-subitem {
		&::before {
			left: 50%;
			transform: translate(-50%, 0);
		}
	}

	.timeline-subitem.left,
	.timeline-subitem.right {
		width: calc(100% - 3rem);
		margin-left: 3rem;
	}

	.timeline-subitem[data-type='encounter'],
	.timeline-subitem[data-type='narrative'] {
		&.left .timeline-content::before,
		&.right .timeline-content::before {
			left: -2rem;
			right: auto;
		}
	}

	.timeline-item-session {
		top: calc(-1rem + 1px);
	}

	/* View Panel Layout */
	.view-body {
		flex-direction: column;
		align-items: center;
		overflow: auto;
	}

	.view-list-panel {
		inline-size: calc(100% - 1rem);
		block-size: 15rem;
		border-inline-end: none;
		border-block-end: 0.125rem solid var(--color-border);
		border-radius: 0;
		order: 1 !important;
	}

	.view-detail-panel {
		flex: 1;
		order: 2;
		/* overflow: auto; */
		inline-size: 100%;
	}

	.view-section {
		&:has(.encounter-timeline-section) {
			inline-size: calc(100% - rem);
		}

		.view-detail-name {
			font-size: 1.4rem;
		}

		.view-header {
			inline-size: calc(100%);
			background: linear-gradient(to bottom, #2a2823, #1c1a16);
			padding: var(--spacing-xs);
		}

		.view-header h2 {
			color: var(--color-parchment);
			font-size: 12pt;

			&::before,
			&::after {
				inset-block-start: 0;
			}
		}

		.view-detail-header {
			flex-direction: column;
			align-items: center;
			text-align: center;
		}

		.view-portrait {
			inline-size: 6rem;
			block-size: 6rem;
		}

		/* Encounter Timeline Entry (smaller mobile timeline entry) */
		.timeline-entry {
			display: flex;
			align-items: center;
			justify-content: flex-start;
			gap: 0.5rem;
			padding: 0.5rem;
		}

		.timeline-turn {
			font-size: 0.75rem;
			display: none;
		}

		.timeline-icon {
			width: 1.5rem;
			height: 1.5rem;
			font-size: 1rem;
			order: 1;
			margin-left: auto;
		}

		.timeline-content-line {
			font-size: 0.85rem;
			justify-content: flex-start !important;
		}

		.view-body:has(.encounter-timeline-section) {
			max-inline-size: 100%;
		}

		.timeline-placeholder {
			display: none;
		}

		.initiative-list {
			grid-template-columns: repeat(auto-fill, 15rem);
		}

		.initiative-item {
			gap: 0.5rem;
			padding: 0.4rem 0.5rem;
		}

		.initiative-rank {
			width: 1.5rem;
			height: 1.5rem;
			font-size: 0.75rem;
		}

		.initiative-character {
			font-size: 0.85rem;
		}

		.initiative-value {
			font-size: 0.9rem;
		}
	}
}

/* Tablet Breakpoint (max-width: 768px / 48rem) - General Layout, Tooltips, and Timeline refinements */
@media (max-width: 768px) {
	/* Tooltip Adjustments */
	.character-tooltip-container {
		max-width: 280px;
	}

	.entity-tooltip,
	.character-tooltip {
		font-size: 9pt;
	}

	.tooltip-header {
		padding: 0.5rem;
	}

	.tooltip-header h3 {
		font-size: 10pt;
	}

	.tooltip-header img {
		width: 32px;
		height: 32px;
	}

	.tooltip-content {
		padding: 0.5rem;
	}

	.tooltip-description {
		font-size: 8.5pt;
	}

	/* Timeline Refinements */
	.timeline-header {
		width: 100%;
		margin-bottom: 0.25rem;
		margin-top: 0.25rem;
	}

	.story-timeline-container {
		width: unset;
		overflow: unset;
		padding: 0 0.5rem; /* Added from original for consistency */
	}

	.timeline {
		width: 90%;
	}

	.timeline-item {
		width: calc(100% - 1.5rem);
		margin-left: 1.5rem;
	}

	.timeline-main-item {
		&.left,
		&.right {
			&::before {
				width: 30px;
				height: 30px;
				left: -2.5rem;
			}
		}
	}

	.timeline-subitem.new-session-indicator::after {
		width: 100%;
		left: 0;
	}

	/* Story Content Layout */
	.story-main-content {
		grid-template-columns: 1fr;
		overflow: auto;
	}

	.story-content-area {
		flex-direction: column;
		block-size: auto;
		max-block-size: none;
		overflow: visible;
	}

	.story-sidebar {
		border-inline-end: none;
		border-block-end: 0.125rem solid var(--color-secondary);
		overflow: visible;
		inline-size: 100%;
	}

	.story-image-container.image-inline {
		float: unset;
		margin: 0.5rem 0;
	}

	/* Character and TOC Adjustments */
	.character-info {
		flex-direction: column;
		justify-content: flex-start;
		gap: 0;
	}

	.character-details {
		text-align: center;
	}

	.character-profile {
		flex-direction: column;
		align-items: center;
		gap: 1rem;
		text-align: center;
	}

	.character-profile-image {
		inline-size: 7.5rem;
		block-size: 7.5rem;
		object-fit: cover;
	}

	.story-character-list {
		justify-content: center;
	}

	.session-toc {
		inline-size: auto;
	}

	.toc {
		max-block-size: none;
	}

	/* Session and Quest */
	.session-content {
		padding: var(--spacing-md);
		overflow: visible;
	}

	.story-quest-container {
		align-items: unset !important;
	}

	.quest-list {
		inline-size: calc(100% - 3rem);
	}

	/* Image Floats */
	.image-align-left,
	.image-align-right {
		float: none;
		max-inline-size: 90%;
		text-align: center;
		display: block;
	}

	/* View Container */
	.story-view-container {
		align-items: unset !important;
	}
}

/* Mobile Breakpoint (max-width: 480px) - Tooltip and Timeline final tweaks */
@media (max-width: 480px) {
	/* Tooltip Final Tweaks */
	.character-tooltip-container {
		max-width: calc(100vw - 20px);
	}

	.tooltip-meta {
		flex-wrap: wrap;
		gap: 0.3rem;
	}

	.tooltip-ability-scores {
		grid-template-columns: repeat(6, 1fr);
	}

	/* Timeline Final Tweaks */
	.timeline {
		width: 95%;
	}

	.timeline-item {
		width: calc(100% - 2rem);
		margin-left: 1.2rem;
	}

	.timeline-subitem.left,
	.timeline-subitem.right {
		width: calc(100% - 4rem);
		align-self: flex-start;
	}

	.timeline-main-item {
		&.left,
		&.right {
			&::before {
				width: 25px;
				height: 25px;
				left: -2rem;
			}

			&::after {
				width: 1.5rem;
				left: -1.5rem;
			}
		}
	}

	.story-header {
		padding: var(--spacing-sm);
	}

	.story-character-list {
		grid-template-columns: 1fr;
	}

	.session-content {
		padding: var(--spacing-sm);
	}

	.session-main-content {
		padding: var(--spacing-md);
	}

	.session-header h2::before,
	.session-header h2::after {
		display: none;
	}

	.character-profile-image {
		inline-size: 6.25rem;
		block-size: 6.25rem;
	}
}
